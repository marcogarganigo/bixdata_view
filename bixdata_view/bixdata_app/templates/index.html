{% extends 'base.html' %}
{% load static %}


{% block body %}

    <style>
        .select2-container--default .select2-selection--single {
            line-height: 28px;
            font-size: 15px;
            border: 1px solid #dee2e6 !important;
        }


        .select2-selection__rendered {
            color: #6c757d !important;
        }

        .select2-container {
            width: 50% !important;
        }

        .select2-selection__rendered {
            line-height: 37px !important;
        }

        .select2-container .select2-selection--single {
            height: 41px !important;
        }

        .select2-selection__arrow {
            height: 39px !important;
        }


        .select2-selection__choice {
            background-color: whitesmoke !important;
            color: black !important;
        }


        .select2-container--open {
            z-index: 9999999;
        }
    </style>

    <div class="wrapper" style="height: 100%">
        <style>
            .content-page {
                height: calc(100% - 90px);
            }
        </style>
        <script type="text/javascript">



            const min_width = 3200;
            const med_width = 1800
            //const fhd_width = 1920;


            if (window.innerWidth <= 1800) {
                $("html").attr("data-sidenav-size", "condensed");
                $(".tabs-title").attr("display", "none");
                $(".tabs-icon").attr("display", "visible");
                $(".card-body").attr("display", "none");
            }


            $("#bixdata2").ready(function () {
                {% if content == '' %}
                    {% for dashboard in active_dashboards %}
                        {% if dashboard.id == default_dashboard %}
                            getDashboard('{{ dashboard.id }}');
                        {% endif %}
                    {% endfor %}
                {% endif %}



                $("#toggle-menu").click(function () {
                    //$("#content_container").load('/loading/');

                    var current_sidenav_size = $("html").attr("data-sidenav-size");
                    if (current_sidenav_size == 'default') {
                        $("html").attr("data-sidenav-size", "condensed");
                    } else {
                        $("html").attr("data-sidenav-size", "default");
                    }

                });


            });

            function getContentRecords(tableid) {
                var serialized_data = [];
                //$("#content_container").load('/loading/');

                serialized_data.push({name: 'tableid', value: tableid});
                serialized_data.push({name: 'searchTerm', value: ''});
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'content_records' %}",
                    data: serialized_data,
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function (response) {
                        $("#content_container").html(response);
                    }
                });
            }

            function getScript() {
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'get_script' %}",
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function (response) {
                        $("#content_container").html(response);
                    }
                });
            }

            function getUserStatsPage() {
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'get_user_stats_page' %}",
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function (response) {
                        $("#content_container").html(response);
                    }
                });
            }

            function getContentRecordsAdmin(page) {
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'admin_page' %}",
                    data: {
                        'page': page
                    },
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function (response) {
                        $("#content_container").html(response);
                    }
                });
            }

            function getContentReport() {
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'content_report' %}",
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function (response) {
                        $("#content_container").html(response);
                    }
                });
            }

            function getTestContent(content_page) {
                var serialized_data = [];
                serialized_data.push({name: 'content_page', value: content_page});
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'test_content' %}",
                    data: serialized_data,
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function (response) {
                        $("#content_container").html(response);
                    }
                });
            }

            function getTestQuery(content_page) {
                var serialized_data = [];
                serialized_data.push({name: 'content_page', value: content_page});
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'test_query' %}",
                    data: serialized_data,
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function (response) {
                        $("#content_container").html(response);
                    }
                });
            }

            function getAdminTableSettings(page) {

                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'admin_table_settings' %}",
                    data: {
                        'page': page
                    },
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function (response) {
                        $("#content_container").html(response);
                    }
                });
            }

            function getAdminOrderSettings(page) {
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'order_settings' %}",
                    data: {
                        'page': page
                    },
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function (response) {
                        $("#content_container").html(response);
                    }
                });
            }

            function getViewSettingsTable(page) {
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'settings_table' %}",
                    data: {
                        'page': page
                    },
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function (response) {
                        $("#content_container").html(response);
                    }
                });
            }

            function getUsersSettings() {
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'settings_user' %}",
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function (response) {
                        $("#content_container").html(response);
                    }
                });
            }

            function getViewSettingsCharts() {
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'settings_charts' %}",
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function (response) {
                        $("#content_container").html(response);
                    }
                });
            }


            function getRenderChartsView() {
                var serialized_data = [];

                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'charts_view' %}",
                    data: serialized_data,
                    success: function (response) {
                        //$("#content_container").load('/loading/');
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function () {
                        //$("#content_container").load('/loading/');
                        $("#content_container").html(response);
                    }
                });
            }

            function getDashboard(dashboardid) {
                var size = window.innerWidth;
                var resolution = '';
                if (size < 1900) {
                    resolution = 'small'
                } else {
                    resolution = 'full'
                }
                //$("#content_container").load('/loading/');
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    data: {
                        'size': resolution,
                        'dashboard_id': dashboardid
                    },
                    url: "{% url 'dashboard' %}",
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function (response) {
                        $("#content_container").html(response);
                    }
                });
            }

            function get_settings() {
                //$("#content_container").load('/loading/');
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'get_settings' %}",
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function (response) {
                        $("#content_container").html(response);
                    }
                });
            }

            function send_unique_active_task(el) {
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'send_unique_active_task' %}",
                    success: function (response) {
                        swal({
                            title: "Report inviato!",
                            text: "Il report è stato inviato correttamente.",
                            icon: "success",
                            timer: 800,
                            buttons: false,
                        })
                    },
                    error: function (response) {
                        swal({
                            title: "Report inviato!",
                            text: "Il report è stato inviato correttamente.",
                            icon: "success",
                            timer: 1000,
                            buttons: false,
                        })
                    }
                });
            }

            function get_account() {
                //$("#content_container").load('/loading/');
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'get_account' %}",
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function (response) {
                        $("#content_container").html(response);
                    }
                });
            }


            function open_record(el, tableid, recordid, contextfunction = 'edit', target = '',) {
       
                if ($(el).closest('.block-records-table-standard').attr('data-show') == 'modal') {
                    target = 'modal'
                }


                console.info('index.html-open_record')
                window.content = el;


                var serialized_data = [];
                serialized_data.push({name: 'tableid', value: tableid});
                serialized_data.push({name: 'recordid', value: recordid});
                serialized_data.push({name: 'contextfunction', value: contextfunction});

                if (tableid == 'deal') {
                    target = 'modal'
                }


                //errore, aggiungere un attributo alla tabella per capire se è nella dashboard oppure no

                min_width_var = min_width
                {% if layout_setting == 'modal' %}
                    min_width_var = 5000;
                {% endif %}



                if (target == 'modal') {
                    min_width_var = 5000;
                }
                /*
                    if (tableid == "deal") {
                        min_width_var = 5000;
                        target = "popup"
                    }
                */
                if (($(el).closest('#block_records_table')).attr('data-type') === 'linked') {
                    master_tableid=$(el).closest('.block_record_card').data('tableid')
                    serialized_data.push({name: 'master_tableid', value: master_tableid});
                    master_recordid=$(el).closest('.block_record_card').data('recordid')
                    serialized_data.push({name: 'master_recordid', value: master_recordid});
                    
                }
                


                if (window.innerWidth <= min_width_var) {

                    if ($(el).attr('data-fieldtype') === 'linked') {
                        console.info('index.html-open_record: Linked modal da bottone')
                        $('#linked-table-modal').modal('show');

                    } else {
                        if (($(el).closest('#block_records_table')).attr('data-type') === 'linked') {
                            console.info('index.html-open_record: Linked modal da tabella')
                            $('#linked-table-modal').modal('show');

                        } else {
                            console.info('index.html-open_record: Modal')
                            $('#recordModal').modal('show');
                        }
                    }


                } else {
                    if ($(el).attr('data-fieldtype') === 'linked') {
                        console.info('index.html-open_record: Linked modal da bottone')
                        $('#linked-table-modal').modal('show');

                    } else {
                        if (($(el).closest('#block_records_table')).attr('data-type') === 'linked') {
                            console.info('index.html-open_record: Linked modal da tabella')
                            $('#linked-table-modal').modal('show');
                        } else {
                            if (window.innerWidth > min_width_var) {
                            }
                        }
                    }
                }


                /*
                if (window.innerWidth <= min_width_var) {

                    if ($(el).attr('data-fieldtype') === 'linked') {
                        $("#linked-table-modal-content").load('/loading/');
                    } else {
                        if (($(el).closest('#block_records_table')).attr('data-type') === 'linked') {
                            $("#linked-table-modal-content").load('/loading/');
                        } else {
                            $("#record-modal-content").load('/loading/');
                        }
                    }


                    } else {
                    if ($(el).attr('data-fieldtype') === 'linked') {
                        $("#linked-table-modal-content").load('/loading/');
                    } else {
                        if (($(el).closest('#block_records_table')).attr('data-type') === 'linked') {
                            $("#linked-table-modal-content").load('/loading/');
                        } else {
                            if (window.innerWidth > min_width_var) {
                                $("#block-record-card-container").load('/loading/');
                            }
                        }
                    }
                }
                */


                //$("#block-record-card-container").html('caricamento');

                $.ajax({
                    type: "POST",
                    url: "{% url 'block_record_card' %}",
                    data: serialized_data,
                    success: function (response) {

                        //if ($(el.closest('table')).attr('data-type') === 'linked') {
                        //if ($(el.closest('#block_records_table')).attr('data-type') === 'linked') {
                        if (($(el).closest('#block_records_table')).attr('data-type') === 'linked' || $(el).attr('data-fieldtype') === 'linked') {
                            //$("#linked-table-modal").html(response);
                            //$("#linked-table-modal").modal("show");
                            //$('.modal-backdrop').hide()
                            //$(".modal-backdrop").css("z-index", 11200);
                            $("#linked-table-modal-content").html(response);
                        } else {
                            if (target == "") {
                                if (window.innerWidth > min_width_var) {
                                    $("#block-record-card-container").html(response);
                                } else {
                                    $("#record-modal-content").html(response);
                                }
                            } else {
                                if (target == "card") {
                                    $("#block-record-card-container").html(response);
                                }
                                if (target == "modal") {
                                    $("#record-modal-content").html(response);
                                }
                            }

                        }
                    },
                    error: function (response) {
                        $("#bixdata_recordcard_container").html(response);
                    }
                });

            }

            


            function load_badge(tableid, recordid) {

                badge_id = tableid + '-' + recordid
                //$("#badge-container-" + badge_id).load('/loading/')
                $("#badge-container-" + badge_id).html('test1')
                $.ajax({
                    url: "{% url 'get_block_record_badge' %}",
                    type: 'POST',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'tableid': tableid,
                        'recordid': recordid,
                    },
                    success: function (response) {
                        $("#badge-container-" + badge_id).html(response)
                    },
                    error: function (response) {
                    }
                });
            }

            function closeCard(vrbl) {
                $(vrbl).closest('.modal').modal('hide');
                $(vrbl).closest('.modal').html('')

                setTimeout(function () {
                }, 1000);
                if (window.innerWidth > min_width) {
                    $(vrbl).closest("#RecordCard").slideToggle(200, function () {
                    });

                }
            }

            $('.modal').on('hidden.bs.modal', function (e) {
                // Remove the content of the component here
                //$('#RecordCard').html('');
                $('#bixdata_recordcard_container').html('');
            })


            $('#newRecordModal').on('hidden.bs.modal', function (e) {
                $("#fullwidth_modal_newrecord").html("");
            });




            function closeLinkedTableModal() {
                $("#linked-table-modal").modal("hide");
            }

            function getSchedulerSettings() {
                $.ajax({
                    type: "POST",
                    crossDomain: true,
                    url: "{% url 'scheduler' %}",
                    success: function (response) {
                        $("#content_container").html(response);
                        $('[data-toggle="tooltip"]').tooltip();
                    },
                    error: function () {
                        $("#content_container").html(response);
                    }
                });
            }


            function handleImageError(img) {
                img.style.display = 'none';

            }

        </script>

        <div id="bixdata2" style="height: 100%">
            <input type="hidden" id="saved_layout">
            <!-- ========== Topbar Start ========== -->
            <div class="navbar-custom topnav-navbar">
                <div class="container-fluid detached-nav">

                    <!-- Topbar Logo -->
                    <div class="logo-topbar">
                        <!-- Logo light -->
                        <a class="sidebar-brand d-flex align-items-center justify-content-center"
                           href="{{ index.html }}">

                            <p class="shadow-sm p-0 mb-0 bg-white rounded"
                               style="width: 50px; color: red; margin-right: 1px;"> <span class="logo-sm">
                            <img src="{% static 'images/logos/logo_big_' %}{{ theme }}.jpg" alt="small logo"
                                 height="55">

                        </span></p>

                            <p class=" mb-0" style="width: 50px; color: white; margin-left: 0px;"> <span
                                    class="logo-sm">
                           <img src="{% static 'images/logos/logo_big_' %}{{ theme }}.jpg" alt="small logo"
                                height="55">
                        </span></p>
                        </a>

                        <!-- Logo Dark -->
                        <a href="{{ index.html }}" class="logo-dark">
                            <span class="logo-lg">
                                <img src="{% static 'images/logo-dark.png' %}" alt="dark logo" height="22">
                            </span>
                            <span class="logo-sm">
                                <img src="{% static 'images/logo-dark-sm.png' %}" alt="small logo" height="22">
                            </span>
                        </a>
                    </div>

                    <!-- Sidebar Menu Toggle Button -->
                    <button class="button-toggle-menu" id="toggle-menu">
                        <i class="mdi mdi-menu"></i>
                    </button>

                    <!-- Horizontal Menu Toggle Button -->
                    <button class="navbar-toggle" data-bs-toggle="collapse" data-bs-target="#topnav-menu-content">
                        <div class="lines">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </button>

                    <ul class="list-unstyled topbar-menu float-end mb-0">
                        <li class="dropdown notification-list d-lg-none">
                            <a class="nav-link dropdown-toggle arrow-none" data-bs-toggle="dropdown"
                               role="button" aria-haspopup="false" aria-expanded="false">
                                <i class="ri-search-line noti-icon"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-animated dropdown-lg p-0">
                                <form class="p-3">
                                    <input type="search" class="form-control" placeholder="Search ..."
                                           aria-label="Recipient's username">
                                </form>
                            </div>
                        </li>

                        <!--
                        <li class="dropdown notification-list">
                            <a class="nav-link dropdown-toggle arrow-none" data-bs-toggle="dropdown" href="{% url 'under_construction' %}">
                                <i class="ri-notification-3-line noti-icon"></i>
                                <span class="noti-icon-badge"></span>
                            </a>

                        </li>
                    -->

                        <li onclick="get_settings()" class="notification-list d-none d-sm-inline-block">
                            <a class="nav-link" data-bs-toggle="offcanvas" href="#theme-settings-offcanvas">
                                <i class="ri-settings-3-line noti-icon" data-bs-toggle="tooltip"
                                   data-bs-placement="bottom" data-bs-title="Impostazioni"></i>
                            </a>
                        </li>

                        <script>
                            const time = Date.now();
                        </script>

                        <li class="dropdown notification-list">
                            <a class="nav-link dropdown-toggle nav-user arrow-none me-0" data-bs-toggle="dropdown"
                               role="button" aria-haspopup="false" aria-expanded="false">
                                <span class="account-user-avatar">
                                    <img src="{% static 'images/users/' %}{{ username }}.png?v={{ date }}" alt="{{ username }}"
                                         class="rounded-circle">
                                </span>
                                <span>
                                    <span class="user-hover">
                                        <span class="account-user-name">{{ username }}</span>
                                        <span class="account-position">{{ role }}</span>
                                    </span>
                                </span>
                            </a>
                            <div
                                    class="dropdown-menu dropdown-menu-end dropdown-menu-animated topbar-dropdown-menu profile-dropdown">
                                <!-- item-->
                                <div class=" dropdown-header noti-title">
                                    <h6 class="text-overflow m-0">Welcome !</h6>
                                </div>

                                <a class="dropdown-item notify-item" onclick="get_account()">
                                    <i class="mdi mdi-lifebuoy me-1"></i>

                                    <span>Account</span>
                                </a>

                                <!-- item-->
                                <a onclick="get_settings()" class="dropdown-item notify-item">
                                    <i class="mdi mdi-account-edit me-1"></i>
                                    <span>Settings</span>
                                </a>


                                <!-- item-->
                                <a class="dropdown-item notify-item" onclick="support('ticketbixdata')">
                                    <i class="mdi mdi-lifebuoy me-1"></i>

                                    <span>Support</span>
                                </a>


                                <script>
                                    function support(tableid) {
                                        $('#newRecordModal').modal('show');
                                        var serialized_data = [];
                                        serialized_data.push({name: 'tableid', value: tableid});
                                        serialized_data.push({name: 'function', value: 'insert'});
                                        serialized_data.push({name: 'http_response', value: true});
                                        $.ajax({
                                            type: "POST",
                                            url: "{% url 'get_record_fields' %}",
                                            data: serialized_data,
                                            success: function (response) {
                                                $("#fullwidth_modal_newrecord").html(response);

                                            },
                                            error: function () {
                                                $("#bixdata_recordcard_container").html(response);
                                            }
                                        });


                                    }
                                </script>


                                <script>
                                    function openSupportModal() {
                                        $('#supportModal').modal('show');
                                    }
                                </script>

                                <!-- item-->
                                <a href="{% url 'logout' %}" class="dropdown-item notify-item">
                                    <i class="mdi mdi-logout me-1"></i>
                                    <span>Logout</span>
                                </a>
                            </div>
                        </li>
                    </ul>

                    <!-- Topbar Search Form -->
                     <div class="app-search dropdown">
                    <!--
                        <form>
                            <div class="input-group">
                                <input type="search" class="form-control dropdown-toggle" placeholder="Search..."
                                       id="top-search" autocomplete="off">
                                <span class="mdi mdi-magnify search-icon"></span>
                                <button class="input-group-text btn btn-primary" type="submit"
                                        style="background-color: #ff5b5b; border: #ff5b5b">Cerca
                                </button>
                            </div>
                        </form>


                        <div class="dropdown-menu dropdown-menu-animated dropdown-lg" id="search-dropdown">
                            <h4>Qui non c'è ancora niente ma ci stiamo lavorando</h4>
                            <img src="{% static 'images/mauro&lorenzo.jpg' %}" width="300px">
                        </div>
                        -->
                    </div>
                </div>
            </div>
            <!-- ========== Topbar End ========== -->

            <!-- ========== Left Sidebar Start ========== -->
            <div class="leftside-menu">

                <!-- Logo Light -->
                <div class="logo-topbar" style="height: 100%;">
                    <!-- Logo light -->


                    <!-- Logo Dark -->
                    <div id="logo-leftside" href="{{ index.html }}" class="logo logo-dark" style="height: 70px">
                    <span class="logo-lg sidebar-brand d-flex align-items-center justify-content-center">
                        <a class="sidebar-brand d-flex align-items-center justify-content-center"
                           href="{{ index.html }}">



                             <span id="logo-leftside-bix">
                             <img src="{% static 'images/logos/logo_big_' %}{{ theme }}.jpg" alt="small logo"
                                  height="59" style="margin-top: 3%">
                        </span>
                        </a>
                    </span>

                        <span class="logo-sm sidebar-brand d-flex align-items-center justify-content-center">
                        <a class="sidebar-brand d-flex align-items-center justify-content-center"
                           href="{{ index.html }}">




                             <span id="logo-leftside-bix" style="margin-top: 30%">
                            <img src="{% static 'images/logos/logo_small_' %}{{ theme }}.jpg" alt="small logo"
                                 height="32">

                            </span>

                        </a>
                    </span>
                    </div>

                    <!-- Sidebar Hover Menu Toggle Button -->
                    <button type="button" class="bg-transparent button-sm-hover p-0" data-bs-toggle="tooltip"
                            data-bs-placement="right" title="Show Full Sidebar">
                        <i class="ri-checkbox-blank-circle-line align-middle"></i>
                    </button>

                    <!-- Sidebar -left -->
                    <div class="h-100" id="leftside-menu-container" data-simplebar>

                        <!--- Sidemenu -->
                        <ul class="side-nav">

                            <li class="side-nav-item">
                                <a data-bs-toggle="collapse" onclick="" href="#sidebarFavoriteTables" aria-expanded="true"
                                   aria-controls="sidebarFavoriteTables" class="side-nav-link">
                                    <i class="uil-star"></i>
                                    <span> Preferiti </span>
                                    <span class="menu-arrow"></span>
                                </a>
                                <div class="collapse show" id="sidebarFavoriteTables">
                                    <ul class="side-nav-second-level">
                                        {% for table in favorite_tables %}
                                         <li onclick="getContentRecords('{{ table.tableid }}')">
                                                <a class="side-nav-txt" onclick="setColor(this)">{{ table.description }}</a>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </li>

                            <li class="side-nav-item">
                                <a data-bs-toggle="collapse" onclick="" href="#sidebarDashboards2" aria-expanded="false"
                                   aria-controls="sidebarDashboards2" class="side-nav-link">
                                    <i class="uil-dashboard"></i>
                                    <span> Dashboard </span>
                                    <span class="menu-arrow"></span>
                                </a>
                                <div class="collapse" id="sidebarDashboards2">
                                    <ul class="side-nav-second-level">
                                        {% for dashboard in active_dashboards %}
                                            <li onclick="getDashboard('{{ dashboard.id }}')">
                                                <a class="side-nav-txt" onclick="setColor(this)">{{ dashboard.name }}</a>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </li>

                            <li class="side-nav-item">
                                <a data-bs-toggle="collapse" onclick="getContentReport()" aria-expanded="false" class="side-nav-link">
                                    <i class="uil-newspaper"></i>
                                    <span>Report</span>
                                </a>
                            </li>

                            <script>
                                function setColor(el) {
                                    var els = document.querySelectorAll('.side-nav-txt');
                                    els.forEach(function (el) {
                                        el.classList.remove('sidenavitem-active');
                                    });
                                    el.classList.add('sidenavitem-active');

                                }

                                var els = document.querySelectorAll('.side-nav-txt');
                                els.forEach(function (el) {
                                    el.addEventListener('click', function () {
                                        setColor(el);
                                    });
                                });
                            </script>

                            <li class="side-nav-title side-nav-item">Tables</li>
                            {% for workspace_key, workspace_value in menu_tables.items %}
                                <li class="side-nav-item">
                                    <a data-bs-toggle="collapse" href="#sidebar{{ workspace_value.workspaceid }}"
                                       aria-expanded="false"
                                       aria-controls="sidebar{{ workspace_value.workspaceid }}" class="side-nav-link">
                                        <i class="{{ workspace_value.icon }}"></i>
                                        <span>{{ workspace_value.name }}</span>
                                        <span class="menu-arrow"></span>
                                    </a>
                                    <div class="collapse" id="sidebar{{ workspace_value.workspaceid }}">
                                        <ul class="side-nav-second-level">
                                            {% for table in workspace_value.tables %}
                                                <li onclick="getContentRecords('{{ table.id }}')">
                                                    <a class="side-nav-txt"
                                                       onclick="setColor(this)">{{ table.description }}</a>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </div>

                                </li>
                            {% endfor %}


                            {% if username|lower == "admin" or username|lower == "marco.garganigo" or username|lower == "alessandro.galli" %}
                                <li class="side-nav-title side-nav-item">Systems</li>

                                <li class="side-nav-item">
                                    <a data-bs-toggle="collapse" href="#sidebarAdmin" aria-expanded="false"
                                       aria-controls="sidebarAdmin" class="side-nav-link">
                                        <i class="uil-briefcase"></i>
                                        <span>Admin settings</span>
                                        <span class="menu-arrow"></span>
                                    </a>
                                    <div class="collapse" id="sidebarAdmin">
                                        <ul class="side-nav-second-level">
                                            <li onclick="getContentRecordsAdmin('settings_charts')">
                                                <a class="side-nav-txt" onclick="setColor(this)">Grafici</a>
                                            </li>
                                            <li onclick="getViewSettingsTable($(this).find('a').text())">
                                                <a class="side-nav-txt" onclick="setColor(this)">Impostazioni
                                                    tabelle</a>
                                            </li>
                                            <li onclick="getUsersSettings()">
                                                <a class="side-nav-txt" onclick="setColor(this)">Impostazioni utenti</a>
                                            </li>
                                            <li onclick="getSchedulerSettings()">
                                                <a class="side-nav-txt" onclick="setColor(this)">Scheduler</a>
                                            </li>
                                        </ul>
                                    </div>

                                </li>
                            {% endif %}

                            {% if username|lower == 'martina.panetta' or username|lower == 'alessandro.galli' or username|lower == 'davide.crudo' %}
                                <li class="side-nav-item">
                                    <a data-bs-toggle="collapse" href="#sidebarFatturazione" aria-expanded="false"
                                       aria-controls="sidebarAdmin" class="side-nav-link">
                                        <i class="uil-briefcase"></i>
                                        <span>Fatturazione</span>
                                        <span class="menu-arrow"></span>
                                    </a>
                                    <div class="collapse" id="sidebarFatturazione">
                                        <ul class="side-nav-second-level">
                                            <li>
                                                <a href="http://bixcrm01:8822/bixdata/custom/invoices.php"
                                                   class="side-nav-txt" onclick="setColor(this)" target="_blank">Fatturazione</a>
                                            </li>

                                        </ul>
                                    </div>

                                </li>
                            {% endif %}

                            <li class="side-nav-item">
                                <a data-bs-toggle="collapse" onclick="getScript()" aria-expanded="false" class="side-nav-link">
                                    <span>Script</span>
                                </a>
                            </li>

                            <li class="side-nav-item">
                                <a data-bs-toggle="collapse" onclick="getUserStatsPage()" aria-expanded="false" class="side-nav-link">
                                    <span>User Stats</span>
                                </a>
                            </li>

                            {% if username|lower == 'marco.garganigo' or username|lower == 'alessandro.galli' %}
                                <li class="side-nav-item">
                                    <a data-bs-toggle="collapse" href="#sidebarTest" aria-expanded="false"
                                       aria-controls="sidebarAdmin" class="side-nav-link">
                                        <i class="uil-briefcase"></i>
                                        <span>Test</span>
                                        <span class="menu-arrow"></span>
                                    </a>
                                    <div class="collapse" id="sidebarTest">
                                        <ul class="side-nav-second-level">
                                            <li onclick="getTestContent('generico')">
                                                <a class="side-nav-txt" onclick="setColor(this)">Test generico</a>
                                            </li>
                                            <li onclick="getTestQuery('generico')">
                                                <a class="side-nav-txt" onclick="setColor(this)">Test query</a>
                                            </li>
                                        </ul>
                                    </div>

                                </li>
                            {% endif %}

                            <div class="clearfix"></div>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- ========== Left Sidebar End ========== -->
            <!-- ============================================================== -->
            <!-- Start Page Content here -->
            <!-- ============================================================== -->

            <div class="content-page" style="min-height:0px; margin-top:70px;">
                <!-- Start Content-->
                <div class="row" style="height: 100%;">
                    <div id="content_container" style="height: 100%">
                        {{ content }}
                    </div>
                </div>
            </div>


            <div class="modal fade" id="supportModal" aria-labelledby="supportModal" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Bixdata support</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div id="support-modal-content" class="modal-body">

                        </div>
                    </div>
                </div>
            </div>


            <script>

                var modalCounter = 0;

                $(document).ready(function () {
                    $(document).on('show.bs.modal', '.modal', function (event) {
                        var modal = $(this);
                        var zIndex = 1040 + modalCounter;
                        modal.css('z-index', zIndex);
                        setTimeout(function () {
                            var modalId = modal.attr('id');
                            $('.modal-backdrop:last').attr('id', modalId + 'modal-backdrop');
                            $('.modal-backdrop').not('.modal-stack').css('z-index', zIndex - 1).addClass('modal-stack');

                        }, 0);

                        modalCounter++;
                    });

                    $(document).on('hide.bs.modal', '.modal', function (event) {
                        $('.modal-backdrop.modal-stack:last').removeClass('modal-stack');
                        var modalId = $(this).attr('id');
                        $('#' + modalId + 'modal-backdrop').remove();
                    });
                });


            </script>

            <!-- new record modal-->
            <div class="modal fade" id="newRecordModal" style="width: 100%;" data-bs-backdrop="static" data-bs-keyboard="false">
                <div class="modal-dialog modal-fullscreen" style="">
                    <div class="modal-content" style="width: 100%">
                        <div class="modal-body" style="width: 100%; overflow: hidden">
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                                    onclick="closeNewRecordModal(this)"></button>
                            <div id="fullwidth_modal_newrecord" style="height: 100%; width: 100%;"
                                 class="col-xl-4 col-md-4 mb-4">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--record modal start-->
            <div class="modal fade" id="recordModal"
                 aria-hidden="true" style="width: 100%" data-bs-backdrop="static" data-bs-keyboard="false">
                <div class="modal-dialog  modal-fullscreen" style="">
                    <div class="modal-content" style="width: 100%">
                        <div class="modal-body" style="width: 100%; overflow: hidden; padding: 0">
                            <div id="record-modal-content" class="col-xl-4 col-md-4 mb-4"
                                 style="height: 100%; width: 100%;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="linked-table-modal"
                 style="width: 100%" data-bs-backdrop="static" data-bs-keyboard="false">
                <div class="modal-dialog modal-fullscreen" style="">
                    <div class="modal-content" style="width: 100%">
                        <div class="modal-body" style="width: 100%; overflow: hidden; padding: 0">
                            <div id="linked-table-modal-content" class="col-xl-4 col-md-4 mb-4"
                                 style="height: 100%; width: 100%;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="newLinkedRecordModal"
                 style="width: 100%;" data-bs-backdrop="static" data-bs-keyboard="false">
                <div class="modal-dialog modal-fullscreen" style="">
                    <div class="modal-content" style="width: 100%">
                        <div class="modal-body" style="width: 100%; overflow: hidden">
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                                    onclick=""></button>
                            <div id="newLinkdeRecordModalContent" class="col-xl-4 col-md-4 mb-4"
                                 style="height: 100%; width: 100%;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div id="modalSmall" class="modal fade" style="width: 100%">
                <div class="modal-dialog modal-dialog-centered modal-fullscreen">
                    <div class="modal-content">
                        <div class="modal-body">
                            Small
                        </div>
                    </div>
                </div>
            </div>

            <div id="modalMedium" class="modal fade" style="width: 75%">
                <div class="modal-dialog modal-dialog-centered modal-md">
                    <div class="modal-content">
                        <div class="modal-body">
                            Medium
                        </div>
                    </div>
                </div>
            </div>

            <div id="modalLarge" class="modal fade" style="width: 50%">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-body">
                            Large
                        </div>
                    </div>
                </div>
            </div>

            <div id="modalExtraLarge" class="modal fade" style="width: 25%">
                <div class="modal-dialog modal-dialog-centered modal-xl">
                    <div class="modal-content">
                        <div class="modal-body">
                            Extra Large
                        </div>
                    </div>
                </div>
            </div>


            <!--record modal end-->

            <!--
        <div class="modal fade" id="supportModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Bixdata support</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form method="post" action="{% url 'support' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="category-select">Category:</label>
                        <select class="form-control" id="category-select" name="category">
                        <option value="">-- Select Category --</option>
                        <option value="technical">Technical Issue</option>
                        <option value="billing">Billing Issue</option>
                        <option value="other">Other Issue</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="description-textarea">Description:</label>
                        <textarea class="form-control" id="description-textarea" name="description" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <div id="image-drop-area" style="border: 2px dashed #ccc; padding: 10px;">
                        <p>Drag and drop images or paste them here</p>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                    </form>
                </div>
                </div>
            </div>
        </div>
    -->


            <script>
                /*
                var imageDropArea = document.getElementById('image-drop-area');


                imageDropArea.addEventListener('dragenter', function (e) {
                    e.preventDefault();
                    imageDropArea.style.backgroundColor = '#eee';
                });

                imageDropArea.addEventListener('dragover', function (e) {
                    e.preventDefault();
                });

                imageDropArea.addEventListener('dragleave', function (e) {
                    imageDropArea.style.backgroundColor = '#fff';
                });

                imageDropArea.addEventListener('drop', function (e) {
                    e.preventDefault();
                    imageDropArea.style.backgroundColor = '#fff';

                    var file = e.dataTransfer.files[0];
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        var img = document.createElement('img');
                        img.src = e.target.result;
                        imageDropArea.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });


                imageDropArea.addEventListener('paste', function (e) {
                    e.preventDefault();

                    var file = e.clipboardData.items[0].getAsFile();
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        var img = document.createElement('img');
                        img.src = e.target.result;
                        imageDropArea.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });
                */

            </script>

            <style>
                /*
                #image-drop-area img {
                    max-width: 100px;
                    max-height: 100px;
                    margin: 5px;
                }
                 */

                .side-nav-item {
                    cursor: pointer;
                }

            </style>


        </div>


    </div>
{% endblock %}
