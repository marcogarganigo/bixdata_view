<style>
    .fc-title {
        font-weight: bold;
    }

    .fc-view {
        margin-top: 10px;
    }

</style>

<script>
    function selectTypeOfDate(datetype) {
        $.ajax({
            type: "POST",
            url: "{% url 'block_records_calendar' %}",
            data: {
                'datetype': datetype,
                'viewid': $('#viewid').val(),
                'tableid': '{{ tableid }}',
            },
            success: function (response) {
                $('#calendar-section-container').html(response);
            },
            error: function (response) {
            }
        
        })
    }
</script>

<div id="calendar-section-container" style="width: 100%; height: 100%">
    <select class="form-select" aria-label="Default select example" onchange="selectTypeOfDate(this.value)">
        {% for field in select_fields %}
            <option {{ field.selected }} value="{{ field.fieldid }}">{{ field.description }}</option>
        {% endfor %}
    </select>

    <div id="content_records_calendar" style="width: 100%; height: 100% !important">
    <div id="calendar" style="height: 100% !important"></div>
    </div>

</div>

<script>
    var jsonEvents = [];

    {% for event in events %}

        {% if event.start is None and event.end is None %}
            allDay = true;

            start = "{{ event.date }}"
            end = "{{ event.date }}"


        {% else %}
            allDay = false;

            start = "{{ event.start }}"
            end = "{{ event.end }}"
            planneddate = "{{ event.date }}"




            startTimeParts = start.split(":");
            endTimeParts = end.split(":");


            startDate = new Date(planneddate);
            startDate.setHours(parseInt(startTimeParts[0], 10));
            startDate.setMinutes(parseInt(startTimeParts[1], 10));

            endDate = new Date(planneddate);
            endDate.setHours(parseInt(endTimeParts[0], 10));
            endDate.setMinutes(parseInt(endTimeParts[1], 10));


            formattedStartDate = startDate.toISOString().slice(0, 19)
            formattedEndDate = endDate.toISOString().slice(0, 19)

            start = formattedStartDate;
            end = formattedEndDate;



        {% endif %}


        jsonEvents.push({
            "title": "{{ event.description }}",
            "start": start,
            "end": end,
            "allDay": allDay,
            "recordid": "{{ event.recordid_ }}",
            //"calendarid": "{{ event.o365_idcalendar }}"
        });

    {% endfor %}




    var calendar = $('#calendar').fullCalendar({
        events: jsonEvents,
        header: {
            left: 'prev,next today',
            center: 'title',
            right: 'month,agendaWeek,agendaDay'
        },
        editable: true,
        aspectRatio: 4.1,
        eventClick: function (event) {
            open_record_calendar(event.recordid);

        },
        eventDrop: function (event, delta, revertFunc) {

        },


        eventRender: function (event, element) {

            // Customize event rendering to display only the event title
            element.find('.fc-title').html(event.title);
        },
    });


    function open_record_calendar(recordid) {
        var serialized_data = [];
        serialized_data.push({name: 'tableid', value: 'task'});
        serialized_data.push({name: 'recordid', value: recordid});
        serialized_data.push({name: 'contextfunction', value: 'edit'});

        $.ajax({
            type: "POST",
            url: "{% url 'block_record_card' %}",
            data: serialized_data,
            success: function (response) {

                $('#block-record-card-container').html(response);
            },
            error: function (response) {
            }
        });

    }
</script>













