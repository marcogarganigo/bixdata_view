<script>
    $(document).ready(function () {

         var events = [];
        {% for event in events %}
            events.push("{{ event.ical_uid }}");
        {% endfor %}

        //console.log(events)


        var jsonEvents = [
            {
                "title": "Event 1",
                "start": "2023-01-01T10:00:00",
                "end": "2023-02-01T12:00:00",
                "allDay": false
            },
        ];

        $.ajax({
            url: '/get_events_recordid/',
            type: 'POST',
            data: {
                'events': JSON.stringify(events),
            },
            dataType: 'json',
            success: function (data) {
                console.log(data)
                for (var i = 0; i < data.length; i++) {
                    var item = data[i];
                    jsonEvents.push({
                        "title": item.title,
                        "start": item.start,
                        "end": item.end,
                        "recordid": item.recordid,
                        "allDay": false,
                        "calendarid": item.o365_idcalendar
                    });
                }
                // Now, you can use the updated jsonEvents array with the added server response data.
                console.log(jsonEvents);
            },
        });


        var calendar = $('#calendar').fullCalendar({
            events: jsonEvents,
            header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek,agendaDay'
            },
            editable: true,
            eventClick: function (event) {
                // Open a modal for editing when the event is clicked
                $('#editEventModal').attr('data-calendarid', event.calendarid);
                $('#eventTitle').val(event.title);


                var eventStart = event.start;
                var formattedDateStart = new Date(eventStart).toISOString().slice(0, 16);
                document.getElementById("eventStart").value = formattedDateStart;

                var eventEnd = event.end;
                var formattedDateEnd = new Date(eventEnd).toISOString().slice(0, 16);
                document.getElementById("eventEnd").value = formattedDateEnd;





                $('#editEventModal').modal('show');
                // Here, you can populate the modal with event details for editing
                // For example, you can use event.title, event.start, and event.end to populate input fields in the modal.
            },
            eventDrop: function (event, delta, revertFunc) {
                alert('dropped')
            },


            eventRender: function (event, element) {

                // Customize event rendering to display only the event title
                element.find('.fc-title').html(event.title);
            },
        });
    });

    function editCalendarEvent(calendarid) {

    }
</script>


<style>
    .fc-title {
        font-weight: bold;
    }
</style>

<div id="content_records_calendar" style="width: 65%;">
    <div id="calendar"></div>
</div>

<!-- Modal for editing events -->
<div class="modal fade" id="editEventModal" tabindex="-1" role="dialog" aria-labelledby="editEventModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editEventModalLabel">Edit Event</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Add input fields here to edit event details -->
                <div class="form-group">
                    <label for="eventTitle">Title</label>
                    <input type="text" class="form-control" id="eventTitle">
                </div>
                <div class="form-group">
                    <label for="eventStart">Start Date and Time</label>
                    <input type="datetime-local" class="form-control" id="eventStart">
                </div>
                <div class="form-group">
                    <label for="eventEnd">End Date and Time</label>
                    <input type="datetime-local" class="form-control" id="eventEnd">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="editCalendarEvent($('#editEventModal').attr('data-calendarid'))">Save Changes</button>
            </div>
        </div>
    </div>
</div>

